[
  {
    "objectID": "data_schema.html",
    "href": "data_schema.html",
    "title": "Data Schema",
    "section": "",
    "text": "All cities included in the California Crime Dashboard are standardized into a common schema. Each row represents one reported crime incident, with consistent columns across:\nThis ensures analytical consistency for trends, forecasting, and geographic comparison."
  },
  {
    "objectID": "data_schema.html#notes-on-data-cleaning",
    "href": "data_schema.html#notes-on-data-cleaning",
    "title": "Data Schema",
    "section": "üîç Notes on Data Cleaning",
    "text": "üîç Notes on Data Cleaning\n\n1. Geographic Filters\nRows are removed if coordinates are:\n\nMissing\nInvalid (0,0)\nOutside realistic California bounds (lat 32‚Äì38, lon ‚Äì125 to ‚Äì114)\n\n\n\n2. Time Features\nGenerated from timestamps:\n\nyear, month, hour\ntime_bin\nday_of_week\nseason\n\n\n\n3. Crime Category Standardization\nCrime codes from each city are mapped into unified categories such as:\n\nProperty Crime\nViolent Crime\nVehicle Crime\nTheft\nVandalism\nFraud\nOther Offenses\n\n\n\n4. Victim Information\nWhen available:\n\nVictim age\nVictim sex\nVictim descent"
  },
  {
    "objectID": "data_schema.html#data-sources",
    "href": "data_schema.html#data-sources",
    "title": "Data Schema",
    "section": "üì¶ Data Sources",
    "text": "üì¶ Data Sources\nThe datasets used in the California Crime Dashboard originate from official open-data portals from Los Angeles, San Diego, and San Francisco. All sources were cleaned and standardized into a unified schema for analysis.\n\nLos Angeles Open Data Portal üîó https://data.lacity.org/\nSan Diego Crime Statistics & Mapping üîó https://www.sandiego.gov/police/data-transparency/crime-statistics\nSan Francisco Open Data Portal üîó https://data.sfgov.org/"
  },
  {
    "objectID": "data_schema.html#file-structure",
    "href": "data_schema.html#file-structure",
    "title": "Data Schema",
    "section": "üìÅ File Structure",
    "text": "üìÅ File Structure\nProcessed dataset names typically look like:\nsan_diego.csv\nsan_diego_with_latlon.csv\nlos_angeles.csv\nsan_francisco.csv"
  },
  {
    "objectID": "data_schema.html#ready-for-use",
    "href": "data_schema.html#ready-for-use",
    "title": "Data Schema",
    "section": "‚úÖ Ready for Use",
    "text": "‚úÖ Ready for Use\nThis schema supports:\n\nTrend analysis\nGeographic visualization\nForecasting models\nRegression analysis\nCross-city comparisons"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "California Crime Dashboard Overview",
    "section": "",
    "text": "üìåAbout This Dashboard\nThis interactive dashboard provides a comprehensive analysis of crime patterns across three major California cities: San Diego, Los Angeles, and San Francisco. The visualizations highlight monthly crime trends, top crime categories, geographic hotspots, and demographic characteristics of victims.\nBy combining multiple data sources and interactive analytics, this dashboard allows users to explore similarities and differences across cities, understand long-term crime behavior, and support data-driven decision making for policy planning, public safety, and resource allocation.\n\n\nüí°MGTA 452 Project Slide\n\n \n\n\n\nüó∫Ô∏è Geographic Distribution of Crime Incidents\n\n\nCode\nimport pandas as pd\nimport plotly.graph_objects as go\n\n# ============================\n# Load data\n# ============================\ndataframes = []\n\ntry:\n    df_sd = pd.read_csv(\"data/san_diego_with_latlon.csv\", low_memory=False)\n    df_sd[\"city\"] = \"San Diego\"\n    dataframes.append(df_sd)\nexcept Exception as e:\n    pass\n\ntry:\n    df_la = pd.read_csv(\"data/los_angeles.csv\", low_memory=False)\n    df_la[\"city\"] = \"Los Angeles\"\n    dataframes.append(df_la)\nexcept Exception as e:\n    pass\n\ntry:\n    df_sf = pd.read_csv(\"data/san_francisco.csv\", low_memory=False)\n    df_sf[\"city\"] = \"San Francisco\"\n    dataframes.append(df_sf)\nexcept Exception as e:\n    pass\n\ndf = pd.concat(dataframes, ignore_index=True)\n\n# ============================\n# Clean and aggregate by area\n# ============================\ndf_map = df[df['latitude'].notna() & df['longitude'].notna()].copy()\ndf_map = df_map[\n    (df_map['latitude'] != 0) &\n    (df_map['longitude'] != 0) &\n    (df_map['latitude'].between(32, 38)) &\n    (df_map['longitude'].between(-125, -114))\n]\n\n# Aggregate by rounding coordinates to create grid cells\n# This dramatically reduces the number of points\ndf_map['lat_rounded'] = (df_map['latitude'] / 0.01).round() * 0.01\ndf_map['lon_rounded'] = (df_map['longitude'] / 0.01).round() * 0.01\n\n# Count crimes per grid cell\ngrid_counts = (\n    df_map.groupby(['city', 'lat_rounded', 'lon_rounded'])\n    .size()\n    .reset_index(name='crime_count')\n)\n\ncities = grid_counts['city'].unique().tolist()\ncolors = {\n    \"San Diego\": \"#2E86AB\",\n    \"Los Angeles\": \"#A23B72\",\n    \"San Francisco\": \"#F18F01\"\n}\n\n# ============================\n# Create figure with scatter map\n# ============================\nfig = go.Figure()\n\nfor city in cities:\n    city_data = grid_counts[grid_counts['city'] == city]\n\n    # Define colorscale based on city\n    if city == \"San Diego\":\n        colorscale = [[0, 'rgba(46,134,171,0.2)'], [0.5, 'rgba(46,134,171,0.6)'], [1, 'rgba(46,134,171,1)']]\n    elif city == \"Los Angeles\":\n        colorscale = [[0, 'rgba(162,59,114,0.2)'], [0.5, 'rgba(162,59,114,0.6)'], [1, 'rgba(162,59,114,1)']]\n    else:  # San Francisco\n        colorscale = [[0, 'rgba(241,143,1,0.2)'], [0.5, 'rgba(241,143,1,0.6)'], [1, 'rgba(241,143,1,1)']]\n\n    fig.add_trace(go.Scattermap(\n        lat=city_data['lat_rounded'],\n        lon=city_data['lon_rounded'],\n        mode='markers',\n        marker=dict(\n            size=city_data['crime_count'].apply(lambda x: min(x/50, 20)),  # Scale size\n            color=city_data['crime_count'],\n            colorscale=colorscale,\n            showscale=True,\n            colorbar=dict(\n                title=\"Crimes\",\n                x=1.02\n            ),\n            sizemode='diameter'\n        ),\n        name=city,\n        visible=(city == cities[0]),\n        hovertemplate=(\n            f\"&lt;b&gt;{city}&lt;/b&gt;&lt;br&gt;\" +\n            \"Location: (%{lat:.3f}, %{lon:.3f})&lt;br&gt;\" +\n            \"Crimes: %{marker.color:,.0f}&lt;extra&gt;&lt;/extra&gt;\"\n        )\n    ))\n\n# Calculate city centers\ncity_centers = {}\nfor city in cities:\n    city_data = df_map[df_map['city'] == city]\n    city_centers[city] = {\n        'lat': city_data['latitude'].median(),\n        'lon': city_data['longitude'].median(),\n        'total': len(city_data)\n    }\n\n# ============================\n# Dropdown menu\n# ============================\nbuttons = []\nfor i, city in enumerate(cities):\n    vis = [False] * len(cities)\n    vis[i] = True\n\n    center = city_centers[city]\n\n    buttons.append(\n        dict(\n            label=f\"{city}\",\n            method=\"update\",\n            args=[\n                {\"visible\": vis},\n                {\n                    \"map.center\": {\"lat\": center['lat'], \"lon\": center['lon']},\n                    \"map.zoom\": 9.5,\n                    \"title\": {\n                        \"text\": f\"&lt;b&gt;Regional Crime Heat Map ‚Äî {city}&lt;/b&gt;&lt;br&gt;&lt;sub&gt;{center['total']:,} incidents across {len(grid_counts[grid_counts['city'] == city]):,} areas&lt;/sub&gt;\"\n                    }\n                }\n            ]\n        )\n    )\n\n# ============================\n# Layout\n# ============================\nfirst_city = cities[0]\nfirst_center = city_centers[first_city]\n\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=buttons,\n            direction=\"down\",\n            pad={\"r\": 10, \"t\": 10},\n            showactive=True,\n            x=0.02,\n            xanchor=\"left\",\n            y=0.98,\n            yanchor=\"top\",\n            bgcolor=\"rgba(255, 255, 255, 0.95)\",\n            bordercolor=\"#CCCCCC\",\n            borderwidth=1,\n            font=dict(size=12)\n        )\n    ],\n    title={\n        \"text\": f\"&lt;b&gt;Regional Crime Heat Map ‚Äî {first_city}&lt;/b&gt;&lt;br&gt;&lt;sub&gt;{first_center['total']:,} incidents across {len(grid_counts[grid_counts['city'] == first_city]):,} areas&lt;/sub&gt;\",\n        \"x\": 0.5,\n        \"xanchor\": \"center\",\n        \"font\": {\"size\": 20}\n    },\n    map=dict(\n        style=\"open-street-map\",\n        center={\"lat\": first_center['lat'], \"lon\": first_center['lon']},\n        zoom=9.5\n    ),\n    margin=dict(t=100, b=20, l=20, r=20),\n    height=700,\n    font=dict(family=\"Arial, sans-serif\", size=12),\n    showlegend=False\n)\n\nfig.show()\n\n\n        \n        \n        \n\n\n                            \n                                            \n\n\n\n\nüîπ Monthly Crime Trends\n\n\nCode\nimport pandas as pd\nimport plotly.graph_objects as go\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n\n# ============================\n# Load data\n# ============================\ndf_sd = pd.read_csv(\"data/san_diego.csv\")\ndf_la = pd.read_csv(\"data/los_angeles.csv\")\ndf_sf = pd.read_csv(\"data/san_francisco.csv\")\n\n# ============================\n# Date cleaning with multiple format support\n# ============================\ndef clean_city(df, city_name):\n    df = df.copy()\n    df[\"city\"] = city_name\n\n    # Store original dates\n    df[\"incident_date_original\"] = df[\"incident_date\"].copy()\n\n    # Try default parsing first\n    df[\"incident_date\"] = pd.to_datetime(df[\"incident_date\"], errors=\"coerce\")\n\n    # For rows that failed, try alternative formats\n    if df[\"incident_date\"].isna().any():\n        mask = df[\"incident_date\"].isna()\n\n        for date_format in [\"%Y-%m-%d\", \"%m/%d/%Y %I:%M:%S %p\", \"%Y-%m-%d %H:%M:%S\", \"%m/%d/%Y\"]:\n            if mask.sum() &gt; 0:\n                try:\n                    df.loc[mask, \"incident_date\"] = pd.to_datetime(\n                        df.loc[mask, \"incident_date_original\"],\n                        format=date_format,\n                        errors=\"coerce\"\n                    )\n                    mask = df[\"incident_date\"].isna()\n                except:\n                    pass\n\n    # Extract date components\n    df[\"year\"] = df[\"incident_date\"].dt.year\n    df[\"month\"] = df[\"incident_date\"].dt.month\n    df[\"month_name\"] = df[\"incident_date\"].dt.strftime(\"%b\")\n\n    valid_dates = df[\"incident_date\"].notna().sum()\n    print(f\"  {city_name}: {valid_dates:,} valid dates ({valid_dates/len(df)*100:.1f}%)\")\n\n    # Drop temporary column\n    df.drop(\"incident_date_original\", axis=1, inplace=True)\n\n    return df\n\ndf_sd = clean_city(df_sd, \"San Diego\")\ndf_la = clean_city(df_la, \"Los Angeles\")\ndf_sf = clean_city(df_sf, \"San Francisco\")\n\n# ============================\n# Merge and aggregate\n# ============================\ndf_all = pd.concat([df_sd, df_la, df_sf], ignore_index=True)\n\n# Remove rows with invalid dates\ndf_all = df_all[df_all[\"year\"].notna()].copy()\n\n# Monthly crime counts\nmonthly_all = (\n    df_all.groupby([\"city\", \"year\", \"month\", \"month_name\"])\n          .size()\n          .reset_index(name=\"crime_count\")\n)\n\n# Month order\nmonth_order = [\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\nmonthly_all[\"month_name\"] = pd.Categorical(monthly_all[\"month_name\"], categories=month_order, ordered=True)\nmonthly_all = monthly_all.sort_values([\"year\", \"month\"])\n\n# Available years\nyears = sorted(monthly_all[\"year\"].dropna().unique())\ntarget_years = [int(yr) for yr in years if 2021 &lt;= yr &lt;= 2025]\n\nif not target_years:\n    raise ValueError(\"No valid years found in the data!\")\n\ndefault_year = target_years[0]\n\n# ============================\n# Build figure\n# ============================\ncities = [\"San Diego\", \"Los Angeles\", \"San Francisco\"]\ncolors = {\"San Diego\": \"#2E86AB\", \"Los Angeles\": \"#A23B72\", \"San Francisco\": \"#F18F01\"}\n\nfig = go.Figure()\n\n# Create traces for each city\nfor city in cities:\n    df_city_year = monthly_all[(monthly_all[\"city\"] == city) & (monthly_all[\"year\"] == default_year)]\n\n    fig.add_trace(go.Scatter(\n        x=df_city_year[\"month_name\"],\n        y=df_city_year[\"crime_count\"],\n        mode='lines+markers',\n        name=city,\n        line=dict(color=colors[city], width=3),\n        marker=dict(size=8),\n        hovertemplate=\"&lt;b&gt;%{fullData.name}&lt;/b&gt;&lt;br&gt;%{x}&lt;br&gt;Crimes: %{y:,}&lt;extra&gt;&lt;/extra&gt;\"\n    ))\n\n# ============================\n# Create dropdown for years\n# ============================\nyear_buttons = []\nfor yr in target_years:\n    button_data = {\"x\": [], \"y\": []}\n\n    for city in cities:\n        df_city_year = monthly_all[(monthly_all[\"city\"] == city) & (monthly_all[\"year\"] == yr)]\n        button_data[\"x\"].append(df_city_year[\"month_name\"].tolist())\n        button_data[\"y\"].append(df_city_year[\"crime_count\"].tolist())\n\n    # Calculate totals for subtitle\n    year_totals = monthly_all[monthly_all[\"year\"] == yr].groupby(\"city\")[\"crime_count\"].sum()\n    subtitle = \" | \".join([f\"{city}: {year_totals.get(city, 0):,.0f}\" for city in cities])\n\n    year_buttons.append(\n        dict(\n            label=str(yr),\n            method=\"update\",\n            args=[\n                button_data,\n                {\n                    \"title\": {\n                        \"text\": f\"&lt;b&gt;Monthly Crime Comparison ({yr})&lt;/b&gt;&lt;br&gt;&lt;sub&gt;{subtitle}&lt;/sub&gt;\",\n                        \"x\": 0.5,\n                        \"xanchor\": \"center\"\n                    }\n                }\n            ]\n        )\n    )\n\n# ============================\n# Layout\n# ============================\ndefault_totals = monthly_all[monthly_all[\"year\"] == default_year].groupby(\"city\")[\"crime_count\"].sum()\ndefault_subtitle = \" | \".join([f\"{city}: {default_totals.get(city, 0):,.0f}\" for city in cities])\n\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=year_buttons,\n            direction=\"down\",\n            pad={\"r\": 10, \"t\": 10},\n            showactive=True,\n            x=1.02,\n            xanchor=\"left\",\n            y=1.15,\n            yanchor=\"top\",\n            bgcolor=\"rgba(255, 255, 255, 0.95)\",\n            bordercolor=\"#CCCCCC\",\n            borderwidth=1,\n            font=dict(size=12)\n        )\n    ],\n    title={\n        \"text\": f\"&lt;b&gt;Monthly Crime Comparison ({default_year})&lt;/b&gt;&lt;br&gt;&lt;sub&gt;{default_subtitle}&lt;/sub&gt;\",\n        \"x\": 0.5,\n        \"xanchor\": \"center\",\n        \"font\": {\"size\": 20}\n    },\n    xaxis_title=\"&lt;b&gt;Month&lt;/b&gt;\",\n    yaxis_title=\"&lt;b&gt;Number of Crimes&lt;/b&gt;\",\n    template=\"plotly_white\",\n    hovermode=\"x unified\",\n    plot_bgcolor=\"rgba(240, 240, 240, 0.3)\",\n    font=dict(family=\"Arial, sans-serif\", size=12),\n    legend=dict(\n        orientation=\"v\",\n        yanchor=\"top\",\n        y=0.98,\n        xanchor=\"left\",\n        x=0.02,\n        bgcolor=\"rgba(255, 255, 255, 0.8)\",\n        bordercolor=\"#CCCCCC\",\n        borderwidth=1\n    ),\n    margin=dict(t=120, b=80, l=80, r=150),\n    height=550\n)\n\n# Update x-axis\nfig.update_xaxes(\n    categoryorder=\"array\",\n    categoryarray=month_order,\n    showgrid=True,\n    gridwidth=1,\n    gridcolor='rgba(128, 128, 128, 0.2)'\n)\n\n# Update y-axis\nfig.update_yaxes(\n    showgrid=True,\n    gridwidth=1,\n    gridcolor='rgba(128, 128, 128, 0.2)'\n)\n\nfig.show()\n\n\n  San Diego: 680,263 valid dates (100.0%)\n  Los Angeles: 1,004,991 valid dates (100.0%)\n  San Francisco: 692,095 valid dates (100.0%)\n\n\n                            \n                                            \n\n\n\n\nüîπ Crime Comparison ‚Äî Weekday\n\n\nCode\nimport pandas as pd\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport warnings\nwarnings.filterwarnings(\"ignore\")\n\n# ============================\n# Load data\n# ============================\n# Load each CSV and add city labels\ndataframes = []\n\n#SD\ndf_sd = pd.read_csv(\"data/san_diego.csv\")\ndf_sd[\"city\"] = \"San Diego\"\ndataframes.append(df_sd)\n#LA\ndf_la = pd.read_csv(\"data/los_angeles.csv\")\ndf_la[\"city\"] = \"Los Angeles\"\ndataframes.append(df_la)\n#SF\ndf_sf = pd.read_csv(\"data/san_francisco.csv\")\ndf_sf[\"city\"] = \"San Francisco\"\ndataframes.append(df_sf)\n\n\ndf = pd.concat(dataframes, ignore_index=True)\n\n# ============================\n# Prep weekday\n# ============================\n# Store original date column before parsing\ndf[\"incident_date_original\"] = df[\"incident_date\"].copy()\n\n# Try multiple date parsing strategies\ndf[\"incident_date\"] = pd.to_datetime(df[\"incident_date\"], errors=\"coerce\")\n\n# If that didn't work, try alternative formats on original values\nif df[\"incident_date\"].isna().any():\n\n    # For rows with NaT, try parsing with different format using original values\n    mask = df[\"incident_date\"].isna()\n\n    # Common alternative formats\n    for date_format in [\"%Y-%m-%d\", \"%m/%d/%Y %I:%M:%S %p\", \"%Y-%m-%d %H:%M:%S\", \"%m/%d/%Y\", \"%d/%m/%Y\"]:\n        if mask.sum() &gt; 0:\n            try:\n                df.loc[mask, \"incident_date\"] = pd.to_datetime(\n                    df.loc[mask, \"incident_date_original\"],\n                    format=date_format,\n                    errors=\"coerce\"\n                )\n                mask = df[\"incident_date\"].isna()\n            except Exception as e:\n                pass\n\n# Drop the temporary column\ndf.drop(\"incident_date_original\", axis=1, inplace=True)\n\ndf[\"weekday\"] = df[\"incident_date\"].dt.day_name()\n\nfor city in df['city'].unique():\n    city_df = df[df['city'] == city]\n    valid_dates = city_df['weekday'].notna().sum()\n\nweekday_order = [\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\",\"Sunday\"]\n\nweekday_counts = (\n    df.groupby([\"city\",\"weekday\"])\n      .size()\n      .reset_index(name=\"count\")\n)\n\nweekday_counts[\"weekday\"] = pd.Categorical(\n    weekday_counts[\"weekday\"],\n    categories=weekday_order,\n    ordered=True\n)\nweekday_counts = weekday_counts.sort_values(\"weekday\")\n\n# Remove any rows with NaN weekday (invalid dates)\nweekday_counts = weekday_counts[weekday_counts['weekday'].notna()]\n\n\n# Pivot for easier access\npivot = weekday_counts.pivot(index=\"weekday\", columns=\"city\", values=\"count\")\n\n\n# Get actual cities present in the data\ncities = pivot.columns.tolist()\ncolors = [\"#2E86AB\", \"#A23B72\", \"#F18F01\"][:len(cities)]  # Modern color palette\n\n# Fill any missing weekdays with 0\npivot = pivot.reindex(weekday_order, fill_value=0)\n\n# Calculate statistics\ncity_stats = {}\nfor city in cities:\n    city_data = pivot[city]\n    city_stats[city] = {\n        \"avg\": city_data.mean(),\n        \"max\": city_data.max(),\n        \"min\": city_data.min(),\n        \"total\": city_data.sum()\n    }\n\n# ============================\n# Build figure with 3 traces (1 per city)\n# ============================\nfig = go.Figure()\n\nfor i, city in enumerate(cities):\n    avg_line = city_stats[city][\"avg\"]\n\n    # Add bar trace\n    fig.add_trace(go.Bar(\n        x=weekday_order,\n        y=pivot[city],\n        name=city,\n        marker_color=colors[i % len(colors)],\n        visible=(i == 0),  # First city visible by default\n        hovertemplate=(\n            \"&lt;b&gt;%{x}&lt;/b&gt;&lt;br&gt;\" +\n            \"Incidents: %{y:,}&lt;br&gt;\" +\n            f\"Average: {avg_line:,.0f}&lt;br&gt;\" +\n            \"&lt;extra&gt;&lt;/extra&gt;\"\n        )\n    ))\n\n    # Add average line\n    fig.add_trace(go.Scatter(\n        x=weekday_order,\n        y=[avg_line] * 7,\n        name=f\"{city} Average\",\n        mode=\"lines\",\n        line=dict(color=colors[i % len(colors)], dash=\"dash\", width=2),\n        visible=(i == 0),  # First city visible by default\n        hovertemplate=f\"Average: {avg_line:,.0f}&lt;extra&gt;&lt;/extra&gt;\"\n    ))\n\n# ============================\n# Dropdown menu\n# ============================\nbuttons = []\nfor i, city in enumerate(cities):\n    vis = [False] * (len(cities) * 2)  # 2 traces per city (bar + line)\n    vis[i * 2] = True      # Bar chart\n    vis[i * 2 + 1] = True  # Average line\n\n    stats = city_stats[city]\n    subtitle = f\"Total: {stats['total']:,} incidents | Avg: {stats['avg']:,.0f} per day | Range: {stats['min']:,}-{stats['max']:,}\"\n\n    buttons.append(\n        dict(\n            label=city,\n            method=\"update\",\n            args=[\n                {\"visible\": vis},\n                {\n                    \"title\": {\n                        \"text\": f\"&lt;b&gt;Weekly Crime Distribution ‚Äî {city}&lt;/b&gt;&lt;br&gt;&lt;sub&gt;{subtitle}&lt;/sub&gt;\",\n                        \"x\": 0.5,\n                        \"xanchor\": \"center\"\n                    }\n                }\n            ]\n        )\n    )\n\n\n# ============================\n# Layout customization\n# ============================\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=buttons,\n            direction=\"down\",\n            pad={\"r\": 10, \"t\": 10},\n            showactive=True,\n            x=0.02,\n            xanchor=\"left\",\n            y=1.15,\n            yanchor=\"top\",\n            bgcolor=\"rgba(255, 255, 255, 0.95)\",\n            bordercolor=\"#CCCCCC\",\n            borderwidth=1,\n            font=dict(size=12)\n        )\n    ],\n    title={\n        \"text\": f\"&lt;b&gt;Weekly Crime Distribution ‚Äî {cities[0]}&lt;/b&gt;&lt;br&gt;&lt;sub&gt;Total: {city_stats[cities[0]]['total']:,} incidents | Avg: {city_stats[cities[0]]['avg']:,.0f} per day | Range: {city_stats[cities[0]]['min']:,}-{city_stats[cities[0]]['max']:,}&lt;/sub&gt;\",\n        \"x\": 0.5,\n        \"xanchor\": \"center\",\n        \"font\": {\"size\": 20}\n    },\n    xaxis_title=\"&lt;b&gt;Weekday&lt;/b&gt;\",\n    yaxis_title=\"&lt;b&gt;Number of Incidents&lt;/b&gt;\",\n    hovermode=\"x unified\",\n    plot_bgcolor=\"rgba(240, 240, 240, 0.3)\",\n    paper_bgcolor=\"white\",\n    font=dict(family=\"Arial, sans-serif\", size=12),\n    showlegend=True,\n    legend=dict(\n        orientation=\"h\",\n        yanchor=\"bottom\",\n        y=-0.2,\n        xanchor=\"center\",\n        x=0.5\n    ),\n    margin=dict(t=120, b=80, l=80, r=40),\n    height=550\n)\n\n# Add grid\nfig.update_xaxes(showgrid=True, gridwidth=1, gridcolor='rgba(128, 128, 128, 0.2)')\nfig.update_yaxes(showgrid=True, gridwidth=1, gridcolor='rgba(128, 128, 128, 0.2)')\n\nfig.show()\n\n\n                            \n                                            \n\n\n\n\nüîπ Crime Comparison ‚Äî Season\n\n\nCode\nimport pandas as pd\nimport plotly.graph_objects as go\n\n# ============================\n# Load data\n# ============================\ndataframes = []\n\ntry:\n    df_sd = pd.read_csv(\"data/san_diego.csv\")\n    df_sd[\"city\"] = \"San Diego\"\n    dataframes.append(df_sd)\nexcept Exception as e:\n    print(f\"‚úó Could not load San Diego: {e}\")\n\ntry:\n    df_la = pd.read_csv(\"data/los_angeles.csv\")\n    df_la[\"city\"] = \"Los Angeles\"\n    dataframes.append(df_la)\nexcept Exception as e:\n    print(f\"‚úó Could not load Los Angeles: {e}\")\n\ntry:\n    df_sf = pd.read_csv(\"data/san_francisco.csv\")\n    df_sf[\"city\"] = \"San Francisco\"\n    dataframes.append(df_sf)\nexcept Exception as e:\n    print(f\"‚úó Could not load San Francisco: {e}\")\n\nif not dataframes:\n    raise ValueError(\"No data files could be loaded!\")\n\ndf = pd.concat(dataframes, ignore_index=True)\n\n# ============================\n# Prep season data\n# ============================\n# Check if season column exists, if not create it from dates\nif 'season' not in df.columns or df['season'].isna().all():\n    print(\"Creating season column from dates...\")\n    df[\"incident_date_original\"] = df[\"incident_date\"].copy()\n    df[\"incident_date\"] = pd.to_datetime(df[\"incident_date\"], errors=\"coerce\")\n\n    # Try alternative formats\n    if df[\"incident_date\"].isna().any():\n        mask = df[\"incident_date\"].isna()\n        for date_format in [\"%Y-%m-%d\", \"%m/%d/%Y %I:%M:%S %p\", \"%Y-%m-%d %H:%M:%S\", \"%m/%d/%Y\"]:\n            if mask.sum() &gt; 0:\n                try:\n                    df.loc[mask, \"incident_date\"] = pd.to_datetime(\n                        df.loc[mask, \"incident_date_original\"],\n                        format=date_format,\n                        errors=\"coerce\"\n                    )\n                    mask = df[\"incident_date\"].isna()\n                except:\n                    pass\n\n    # Create season from month\n    df['month'] = df['incident_date'].dt.month\n    df['season'] = df['month'].apply(lambda x:\n        'Winter' if x in [12, 1, 2] else\n        'Spring' if x in [3, 4, 5] else\n        'Summer' if x in [6, 7, 8] else\n        'Fall' if x in [9, 10, 11] else None\n    )\n\n# Define season order\nseason_order = [\"Winter\", \"Spring\", \"Summer\", \"Fall\"]\n\n# Group by city and season\nseason_counts = (\n    df.groupby([\"city\", \"season\"])\n      .size()\n      .reset_index(name=\"count\")\n)\n\n# Filter out null seasons\nseason_counts = season_counts[season_counts['season'].notna()]\n\n# Ensure all seasons are present for each city\nseason_counts[\"season\"] = pd.Categorical(\n    season_counts[\"season\"],\n    categories=season_order,\n    ordered=True\n)\nseason_counts = season_counts.sort_values(\"season\")\n\n# Pivot for easier access\npivot = season_counts.pivot(index=\"season\", columns=\"city\", values=\"count\")\npivot = pivot.reindex(season_order, fill_value=0)\n\n# Get actual cities present in the data\ncities = pivot.columns.tolist()\ncolors = [\"#2E86AB\", \"#A23B72\", \"#F18F01\"][:len(cities)]\n\n# Calculate statistics\ncity_stats = {}\nfor city in cities:\n    city_data = pivot[city]\n    city_stats[city] = {\n        \"avg\": city_data.mean(),\n        \"max\": city_data.max(),\n        \"min\": city_data.min(),\n        \"total\": city_data.sum()\n    }\n\n# ============================\n# Build figure\n# ============================\nfig = go.Figure()\n\nfor i, city in enumerate(cities):\n    avg_line = city_stats[city][\"avg\"]\n\n    # Add bar trace\n    fig.add_trace(go.Bar(\n        x=season_order,\n        y=pivot[city],\n        name=city,\n        marker_color=colors[i % len(colors)],\n        visible=(i == 0),\n        hovertemplate=(\n            \"&lt;b&gt;%{x}&lt;/b&gt;&lt;br&gt;\" +\n            \"Incidents: %{y:,}&lt;br&gt;\" +\n            f\"Average: {avg_line:,.0f}&lt;br&gt;\" +\n            \"&lt;extra&gt;&lt;/extra&gt;\"\n        )\n    ))\n\n    # Add average line\n    fig.add_trace(go.Scatter(\n        x=season_order,\n        y=[avg_line] * 4,\n        name=f\"{city} Average\",\n        mode=\"lines\",\n        line=dict(color=colors[i % len(colors)], dash=\"dash\", width=2),\n        visible=(i == 0),\n        hovertemplate=f\"Average: {avg_line:,.0f}&lt;extra&gt;&lt;/extra&gt;\"\n    ))\n\n# ============================\n# Dropdown menu\n# ============================\nbuttons = []\nfor i, city in enumerate(cities):\n    vis = [False] * (len(cities) * 2)\n    vis[i * 2] = True      # Bar chart\n    vis[i * 2 + 1] = True  # Average line\n\n    stats = city_stats[city]\n    subtitle = f\"Total: {stats['total']:,} incidents | Avg: {stats['avg']:,.0f} per season | Range: {stats['min']:,}-{stats['max']:,}\"\n\n    buttons.append(\n        dict(\n            label=city,\n            method=\"update\",\n            args=[\n                {\"visible\": vis},\n                {\n                    \"title\": {\n                        \"text\": f\"&lt;b&gt;Seasonal Crime Distribution ‚Äî {city}&lt;/b&gt;&lt;br&gt;&lt;sub&gt;{subtitle}&lt;/sub&gt;\",\n                        \"x\": 0.5,\n                        \"xanchor\": \"center\"\n                    }\n                }\n            ]\n        )\n    )\n\n# ============================\n# Layout customization\n# ============================\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=buttons,\n            direction=\"down\",\n            pad={\"r\": 10, \"t\": 10},\n            showactive=True,\n            x=0.02,\n            xanchor=\"left\",\n            y=1.15,\n            yanchor=\"top\",\n            bgcolor=\"rgba(255, 255, 255, 0.95)\",\n            bordercolor=\"#CCCCCC\",\n            borderwidth=1,\n            font=dict(size=12)\n        )\n    ],\n    title={\n        \"text\": f\"&lt;b&gt;Seasonal Crime Distribution ‚Äî {cities[0]}&lt;/b&gt;&lt;br&gt;&lt;sub&gt;Total: {city_stats[cities[0]]['total']:,} incidents | Avg: {city_stats[cities[0]]['avg']:,.0f} per season | Range: {city_stats[cities[0]]['min']:,}-{city_stats[cities[0]]['max']:,}&lt;/sub&gt;\",\n        \"x\": 0.5,\n        \"xanchor\": \"center\",\n        \"font\": {\"size\": 20}\n    },\n    xaxis_title=\"&lt;b&gt;Season&lt;/b&gt;\",\n    yaxis_title=\"&lt;b&gt;Number of Incidents&lt;/b&gt;\",\n    hovermode=\"x unified\",\n    plot_bgcolor=\"rgba(240, 240, 240, 0.3)\",\n    paper_bgcolor=\"white\",\n    font=dict(family=\"Arial, sans-serif\", size=12),\n    showlegend=True,\n    legend=dict(\n        orientation=\"h\",\n        yanchor=\"bottom\",\n        y=-0.2,\n        xanchor=\"center\",\n        x=0.5\n    ),\n    margin=dict(t=120, b=80, l=80, r=40),\n    height=550\n)\n\n# Add grid\nfig.update_xaxes(showgrid=True, gridwidth=1, gridcolor='rgba(128, 128, 128, 0.2)')\nfig.update_yaxes(showgrid=True, gridwidth=1, gridcolor='rgba(128, 128, 128, 0.2)')\n\nfig.show()\n\n\n                            \n                                            \n\n\n\n\nüîπ Crimes Comparison ‚Äî Top 5 Categories\n\n\nCode\nimport pandas as pd\nimport plotly.graph_objects as go\n\n# ============================\n# Load datasets\n# ============================\n\ndf_sd = pd.read_csv(\"data/san_diego.csv\")\ndf_la = pd.read_csv(\"data/los_angeles.csv\")\ndf_sf = pd.read_csv(\"data/san_francisco.csv\")\n\ndf_sd[\"city\"] = \"San Diego\"\ndf_la[\"city\"] = \"Los Angeles\"\ndf_sf[\"city\"] = \"San Francisco\"\n\n\n# ============================\n# Get top 5 crimes for each city\n# ============================\ndef get_top_crimes(df, n=5):\n    return df[\"crime_description\"].value_counts().head(n)\n\nsd_top5 = get_top_crimes(df_sd, 5)\nla_top5 = get_top_crimes(df_la, 5)\nsf_top5 = get_top_crimes(df_sf, 5)\n\n# Get all unique top crimes across cities\nall_top_crimes = set(sd_top5.index) | set(la_top5.index) | set(sf_top5.index)\n\n# Create a summary dataframe for grouped comparison\ncities_data = {\n    \"San Diego\": df_sd,\n    \"Los Angeles\": df_la,\n    \"San Francisco\": df_sf\n}\n\n# Calculate crime counts for comparison view\ncomparison_data = []\nfor crime in all_top_crimes:\n    for city, df in cities_data.items():\n        count = len(df[df[\"crime_description\"] == crime])\n        if count &gt; 0:\n            comparison_data.append({\n                \"city\": city,\n                \"crime\": crime,\n                \"count\": count\n            })\n\ndf_comparison = pd.DataFrame(comparison_data)\n\n# ============================\n# Prepare individual city data\n# ============================\ncities = [\"San Diego\", \"Los Angeles\", \"San Francisco\"]\ncolors = [\"#2E86AB\", \"#A23B72\", \"#F18F01\"]\n\ncity_top5_data = {\n    \"San Diego\": sd_top5,\n    \"Los Angeles\": la_top5,\n    \"San Francisco\": sf_top5\n}\n\n# ============================\n# Create figure\n# ============================\nfig = go.Figure()\n\n# Add traces for \"All Cities Comparison\" view (grouped bars)\nfor i, city in enumerate(cities):\n    city_df = df_comparison[df_comparison[\"city\"] == city].sort_values(\"count\", ascending=False)\n\n    fig.add_trace(go.Bar(\n        x=city_df[\"crime\"],\n        y=city_df[\"count\"],\n        name=city,\n        marker_color=colors[i],\n        visible=True,  # Comparison view visible by default\n        hovertemplate=\"&lt;b&gt;%{x}&lt;/b&gt;&lt;br&gt;\" + f\"{city}&lt;br&gt;\" + \"Count: %{y:,}&lt;extra&gt;&lt;/extra&gt;\"\n    ))\n\n# Add traces for individual city views\nfor i, city in enumerate(cities):\n    top5 = city_top5_data[city]\n\n    fig.add_trace(go.Bar(\n        x=top5.index,\n        y=top5.values,\n        name=city,\n        marker_color=colors[i],\n        visible=False,  # Individual views hidden by default\n        hovertemplate=\"&lt;b&gt;%{x}&lt;/b&gt;&lt;br&gt;Count: %{y:,}&lt;br&gt;Percentage: %{customdata:.1f}%&lt;extra&gt;&lt;/extra&gt;\",\n        customdata=[val/top5.sum()*100 for val in top5.values]\n    ))\n\n# ============================\n# Create dropdown menu\n# ============================\nbuttons = []\n\n# Button for \"All Cities Comparison\"\nbuttons.append(\n    dict(\n        label=\"All Cities Comparison\",\n        method=\"update\",\n        args=[\n            {\"visible\": [True, True, True, False, False, False]},\n            {\n                \"title\": {\n                    \"text\": \"&lt;b&gt;Top 5 Crimes Comparison ‚Äî All Cities&lt;/b&gt;&lt;br&gt;&lt;sub&gt;Grouped comparison across San Diego, Los Angeles, and San Francisco&lt;/sub&gt;\",\n                    \"x\": 0.5,\n                    \"xanchor\": \"center\"\n                },\n                \"showlegend\": True,\n                \"xaxis\": {\"title\": \"&lt;b&gt;Crime Type&lt;/b&gt;\", \"tickangle\": -45},\n                \"yaxis\": {\"title\": \"&lt;b&gt;Number of Incidents&lt;/b&gt;\"},\n                \"barmode\": \"group\"\n            }\n        ]\n    )\n)\n\n# Buttons for individual cities\nfor i, city in enumerate(cities):\n    vis = [False] * 6\n    vis[3 + i] = True  # Show only the corresponding individual city trace\n\n    total = city_top5_data[city].sum()\n    top_crime = city_top5_data[city].index[0]\n    top_count = city_top5_data[city].values[0]\n\n    buttons.append(\n        dict(\n            label=city,\n            method=\"update\",\n            args=[\n                {\"visible\": vis},\n                {\n                    \"title\": {\n                        \"text\": f\"&lt;b&gt;Top 5 Crimes ‚Äî {city}&lt;/b&gt;&lt;br&gt;&lt;sub&gt;Most common: {top_crime} ({top_count:,} incidents, {top_count/total*100:.1f}%)&lt;/sub&gt;\",\n                        \"x\": 0.5,\n                        \"xanchor\": \"center\"\n                    },\n                    \"showlegend\": False,\n                    \"xaxis\": {\"title\": \"&lt;b&gt;Crime Type&lt;/b&gt;\", \"tickangle\": -45},\n                    \"yaxis\": {\"title\": \"&lt;b&gt;Number of Incidents&lt;/b&gt;\"},\n                    \"barmode\": \"relative\"\n                }\n            ]\n        )\n    )\n\n# ============================\n# Update layout\n# ============================\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=buttons,\n            direction=\"down\",\n            pad={\"r\": 10, \"t\": 10},\n            showactive=True,\n            x=0.02,\n            xanchor=\"left\",\n            y=1.15,\n            yanchor=\"top\",\n            bgcolor=\"rgba(255, 255, 255, 0.95)\",\n            bordercolor=\"#CCCCCC\",\n            borderwidth=1,\n            font=dict(size=12)\n        )\n    ],\n    title={\n        \"text\": \"&lt;b&gt;Top 5 Crimes Comparison ‚Äî All Cities&lt;/b&gt;&lt;br&gt;&lt;sub&gt;Grouped comparison across San Diego, Los Angeles, and San Francisco&lt;/sub&gt;\",\n        \"x\": 0.5,\n        \"xanchor\": \"center\",\n        \"font\": {\"size\": 20}\n    },\n    xaxis_title=\"&lt;b&gt;Crime Type&lt;/b&gt;\",\n    yaxis_title=\"&lt;b&gt;Number of Incidents&lt;/b&gt;\",\n    xaxis_tickangle=-45,\n    plot_bgcolor=\"rgba(240, 240, 240, 0.3)\",\n    paper_bgcolor=\"white\",\n    font=dict(family=\"Arial, sans-serif\", size=12),\n    showlegend=True,\n    legend=dict(\n        orientation=\"h\",\n        yanchor=\"bottom\",\n        y=-0.4,\n        xanchor=\"center\",\n        x=0.5\n    ),\n    margin=dict(t=120, b=120, l=80, r=40),\n    height=600,\n    barmode=\"group\",\n    hovermode=\"closest\"\n)\n\n# Add grid\nfig.update_xaxes(showgrid=True, gridwidth=1, gridcolor='rgba(128, 128, 128, 0.2)')\nfig.update_yaxes(showgrid=True, gridwidth=1, gridcolor='rgba(128, 128, 128, 0.2)')\n\nfig.show()"
  },
  {
    "objectID": "linear_regression.html",
    "href": "linear_regression.html",
    "title": "Multi-City Crime Forecast - LinearRegression",
    "section": "",
    "text": "Code\nimport pandas as pd\nimport numpy as np\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import r2_score\nimport plotly.express as px\n\nSF_forecast = pd.read_csv(\"data/San Francisco_forecast.csv\")\nLA_forecast = pd.read_csv(\"data/Los Angeles_forecast.csv\")\nSD_forecast = pd.read_csv(\"data/San Diego_forecast.csv\")\n\ncombined = pd.concat([SF_forecast, LA_forecast, SD_forecast])\ncombined[\"ds\"] = pd.to_datetime(combined[\"ds\"])\n\nfig = px.line(\n    combined,\n    x=\"ds\",\n    y=\"yhat\",\n    color=\"city\",\n    markers=True,\n    title=\"Crime Forecast Comparison Across Cities (Next 12 Months)\"\n)\n\nfig.update_layout(\n    xaxis_title=\"Month\",\n    yaxis_title=\"Predicted Crime Count\",\n    legend_title=\"City\"\n)\n\n\n        \n        \n        \n\n\n                            \n                                            \n\n\n\n\nCode\ncities = {\n    \"San Francisco\": \"data/SF_monthly.csv\",\n    \"Los Angeles\": \"data/LA_monthly.csv\",\n    \"San Diego\": \"data/SD_monthly.csv\"\n}\n\nresults = []\n\nfor city, path in cities.items():\n    df = pd.read_csv(path)\n    df[\"ds\"] = pd.to_datetime(df[\"ds\"])\n    y = df[\"y\"].values\n    X = np.arange(len(y)).reshape(-1, 1)\n    model = LinearRegression()\n    model.fit(X, y)\n    y_pred = model.predict(X)\n    r2 = r2_score(y, y_pred)\n    results.append([city, r2])\n\nr2_df = pd.DataFrame(results, columns=[\"City\", \"R_squared\"])\nr2_df\n\nr2_df.style.format({\"R_squared\": \"{:.3f}\"})\n\n\n\n\n\n\n\n¬†\nCity\nR_squared\n\n\n\n\n0\nSan Francisco\n0.207\n\n\n1\nLos Angeles\n0.335\n\n\n2\nSan Diego\n0.675\n\n\n\n\n\n\n\nCode\nimport pandas as pd\nimport numpy as np\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import r2_score\nimport plotly.express as px\n\ncities = {\n    \"San Francisco\": \"data/SF_monthly.csv\",\n    \"Los Angeles\": \"data/LA_monthly.csv\",\n    \"San Diego\": \"data/SD_monthly.csv\"\n}\n\nresults = []\n\nfor city, path in cities.items():\n    df = pd.read_csv(path)\n    df[\"ds\"] = pd.to_datetime(df[\"ds\"])\n    y = df[\"y\"].values\n    X = np.arange(len(y)).reshape(-1, 1)\n    model = LinearRegression()\n    model.fit(X, y)\n    y_pred = model.predict(X)\n    r2 = r2_score(y, y_pred)\n    results.append([city, r2])\n\nr2_df = pd.DataFrame(results, columns=[\"City\", \"R_squared\"])\n\nfig = px.bar(\n    r2_df,\n    x=\"City\",\n    y=\"R_squared\",\n    title=\"R¬≤ Comparison Across Cities\",\n    text=\"R_squared\",\n    color=\"City\"\n)\n\nfig.update_layout(yaxis_title=\"R¬≤ Value\")\nfig"
  },
  {
    "objectID": "sd.html",
    "href": "sd.html",
    "title": "San Diego Crime Dashboard",
    "section": "",
    "text": "Code\nimport folium\nfrom folium.plugins import MarkerCluster\nimport pandas as pd\n\n# load dat with lat/lon\ndf_sd = pd.read_csv(\"data/san_diego_with_latlon.csv\")\n\n# build map\nsd_map = folium.Map(location=[32.7157, -117.1611], zoom_start=11)\nmarker_cluster = MarkerCluster().add_to(sd_map)\n\n# sample\ndf_sample = df_sd.sample(n=5000, random_state=42)\n\n# mark\nfor _, row in df_sample.iterrows():\n    folium.CircleMarker(\n        location=[row[\"latitude\"], row[\"longitude\"]],\n        radius=3,\n        color=\"blue\",\n        fill=True,\n        fill_opacity=0.6\n    ).add_to(marker_cluster)\n\nsd_map\n\n\nMake this Notebook Trusted to load map: File -&gt; Trust Notebook\nCode\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\n\n# Load data\ndf = pd.read_csv(\"data/san_diego_with_latlon.csv\")\n\n# Convert incident_date to datetime\ndf[\"incident_date\"] = pd.to_datetime(df[\"incident_date\"], errors=\"coerce\")\n\n# Extract year/month/month_name clearly\ndf[\"year\"] = df[\"incident_date\"].dt.year\ndf[\"month\"] = df[\"incident_date\"].dt.month\ndf[\"month_name\"] = df[\"incident_date\"].dt.strftime(\"%b\")\n\n# clean zip codes\ndf[\"zip_code\"] = df[\"zip_code\"].astype(str).str.replace(\".0\", \"\", regex=False)\n\n# Remove missing dates\ndf = df.dropna(subset=[\"year\", \"month\"])\n\n# Monthly crime totals\nmonthly_total = (\n    df.groupby([\"year\", \"month\", \"month_name\"])\n      .size()\n      .reset_index(name=\"crime_count\")\n)\n\n# Crime Trends Over Time\n\nimport plotly.express as px\n\nyears = sorted(df[\"year\"].unique())\n\nfig = px.line(\n    monthly_total,\n    x=\"month_name\",\n    y=\"crime_count\",\n    color=\"year\",\n    markers=True,\n    title=\"Monthly Crime Totals (Select Year)\",\n    template=\"plotly_white\"\n)\n\n# Dropdown Buttons\nbuttons = []\n\n# Show all years\nbuttons.append(\n    dict(\n        label=\"All Years\",\n        method=\"update\",\n        args=[{\"visible\": [True] * len(years)}]\n    )\n)\n\n# Individual years\nfor i, yr in enumerate(years):\n    visibility = [False] * len(years)\n    visibility[i] = True\n\n    buttons.append(\n        dict(\n            label=str(yr),\n            method=\"update\",\n            args=[{\"visible\": visibility}]\n        )\n    )\n\nfig.update_layout(\n    updatemenus=[\n        dict(buttons=buttons, direction=\"down\", x=1.15, y=1.0)\n    ]\n)\n\nfig.update_xaxes(\n    categoryorder=\"array\",\n    categoryarray=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\n)\n\nfig"
  },
  {
    "objectID": "sd.html#top-zip-codes",
    "href": "sd.html#top-zip-codes",
    "title": "San Diego Crime Dashboard",
    "section": "Top ZIP Codes",
    "text": "Top ZIP Codes\n\n\nCode\n# --- ZIP must be treated as string ---\ndf[\"zip_code\"] = df[\"zip_code\"].astype(str)\n\nzip_counts = (\n    df.groupby(\"zip_code\")\n      .size()\n      .reset_index(name=\"crime_count\")\n      .sort_values(\"crime_count\", ascending=False)\n)\n\ntop_zip = zip_counts.head(10)\n\nfig = px.bar(\n    top_zip.sort_values(\"crime_count\"),\n    x=\"crime_count\",\n    y=\"zip_code\",\n    orientation=\"h\",\n    title=\"Top 10 ZIP Codes by Total Crime\",\n    template=\"plotly_white\",\n)\n\nfig.update_layout(\n    yaxis=dict(type=\"category\"),   # Force categorical y-axis\n)\n\nfig"
  },
  {
    "objectID": "sd.html#zip-code-treemap",
    "href": "sd.html#zip-code-treemap",
    "title": "San Diego Crime Dashboard",
    "section": "ZIP Code Treemap",
    "text": "ZIP Code Treemap\n\n\nCode\nfig = px.treemap(\n    top_zip,\n    path=[\"zip_code\"],\n    values=\"crime_count\",\n    title=\"Top ZIP Codes by Crime Volume\"\n)\n\nfig"
  },
  {
    "objectID": "sf.html",
    "href": "sf.html",
    "title": "San Francisco Crime Dashboard",
    "section": "",
    "text": "Code\nimport pandas as pd\nimport folium\nfrom folium.plugins import MarkerCluster\nimport warnings\nwarnings.filterwarnings(\"ignore\", category=pd.errors.DtypeWarning)\n\ndf = pd.read_csv(\"data/san_francisco.csv\",low_memory=False)\n\n# remove lat/lon\ndf = df.dropna(subset=[\"latitude\", \"longitude\"])\n\n# build map\nsf_map = folium.Map(location=[37.7749, -122.4194], zoom_start=12)\nmarker_cluster = MarkerCluster().add_to(sf_map)\n\n# sample\ndf_sample = df.sample(n=5000, random_state=42)\n\n# add mark\nfor _, row in df_sample.iterrows():\n    folium.CircleMarker(\n        location=[row[\"latitude\"], row[\"longitude\"]],\n        radius=3,\n        color=\"green\",\n        fill=True,\n        fill_opacity=0.6\n    ).add_to(marker_cluster)\n\nsf_map\n\n\nMake this Notebook Trusted to load map: File -&gt; Trust Notebook\nCode\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nimport plotly.express as px\n# Load data\ndf = pd.read_csv(\"data/san_francisco.csv\")\n\n# Convert incident_date to datetime\ndf[\"incident_date\"] = pd.to_datetime(df[\"incident_date\"], errors=\"coerce\")\n\n# Rebuild year, month, month_name\ndf[\"year\"] = df[\"incident_date\"].dt.year\ndf[\"month\"] = df[\"incident_date\"].dt.month\ndf[\"month_name\"] = df[\"incident_date\"].dt.strftime(\"%b\")\n\n# Drop rows missing year or month\ndf = df.dropna(subset=[\"year\", \"month\"])\n\n# Monthly crime totals\nmonthly_total = (\n    df.groupby([\"year\", \"month\", \"month_name\"])\n    .size()\n    .reset_index(name=\"crime_count\")\n)"
  },
  {
    "objectID": "sf.html#crime-trends-over-time",
    "href": "sf.html#crime-trends-over-time",
    "title": "San Francisco Crime Dashboard",
    "section": "Crime Trends Over Time",
    "text": "Crime Trends Over Time\n\n\nCode\nimport plotly.express as px\n\n# Get sorted list of years for the dropdown\nyears = sorted(df[\"year\"].unique())\n\n# Create line chart\nfig = px.line(\n    monthly_total,\n    x=\"month_name\",\n    y=\"crime_count\",\n    color=\"year\",\n    markers=True,\n    title=\"Monthly Crime Totals by Year\",\n    template=\"plotly_white\"\n)\n\n# Dropdown buttons\nbuttons = []\n\n# Button: All Years\nbuttons.append(\n    dict(\n        label=\"All Years\",\n        method=\"update\",\n        args=[{\"visible\": [True] * len(years)}]\n    )\n)\n\n# Buttons: One per year\nfor i, yr in enumerate(years):\n    visibility = [False] * len(years)\n    visibility[i] = True\n    buttons.append(\n        dict(\n            label=str(yr),\n            method=\"update\",\n            args=[{\"visible\": visibility}]\n        )\n    )\n\n# Add dropdown menu\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=buttons,\n            direction=\"down\",\n            x=1.15,\n            y=1.0\n        )\n    ]\n)\n\n# Order months correctly on x-axis\nfig.update_xaxes(\n    categoryorder=\"array\",\n    categoryarray=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\n                   \"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\n)\n\nfig"
  },
  {
    "objectID": "sf.html#finding-the-top-10-neighborhoods-by-total-crimes",
    "href": "sf.html#finding-the-top-10-neighborhoods-by-total-crimes",
    "title": "San Francisco Crime Dashboard",
    "section": "FINDING THE TOP 10 NEIGHBORHOODS BY TOTAL CRIMES",
    "text": "FINDING THE TOP 10 NEIGHBORHOODS BY TOTAL CRIMES\n\n\nCode\nimport plotly.express as px\nimport pandas as pd\n\ndf = pd.read_csv(\"data/san_francisco.csv\",low_memory=False)\n\ntop_neighborhoods = df[\"area_name\"].value_counts().head(10)\n\nfig = px.bar(\n    x=top_neighborhoods.index,\n    y=top_neighborhoods.values,\n    labels={\"x\": \"Neighborhood\", \"y\": \"Incidents\"},\n    title=\"Top 10 Neighborhoods by Number of Crimes ‚Äì San Francisco\",\n    text=top_neighborhoods.values\n)\n\nfig.update_traces(marker_color=\"tomato\", textposition=\"outside\")\nfig.update_layout(\n    xaxis_tickangle=35,\n    template=\"simple_white\",\n    height=500\n)\n\nfig.show()"
  },
  {
    "objectID": "sf.html#types-of-crimes-in-specific-neighborhoods",
    "href": "sf.html#types-of-crimes-in-specific-neighborhoods",
    "title": "San Francisco Crime Dashboard",
    "section": "TYPES OF CRIMES IN SPECIFIC NEIGHBORHOODS",
    "text": "TYPES OF CRIMES IN SPECIFIC NEIGHBORHOODS\n\n\nCode\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\ntemp = df.dropna(subset=[\"area_name\", \"crime_category\"])\npivot = pd.crosstab(temp[\"area_name\"], temp[\"crime_category\"])\n\ntop_neigh = pivot.sum(axis=1).sort_values(ascending=False).head(10).index\ntop_cat = pivot.sum(axis=0).sort_values(ascending=False).head(10).index\n\npivot = pivot.loc[top_neigh, top_cat]\n\nplt.figure(figsize=(10, 6))\nsns.heatmap(pivot, cmap=\"Reds\")\nplt.title(\"Top Crime Categories Across Top Neighborhoods ‚Äì San Francisco\")\nplt.tight_layout()\nplt.show()"
  },
  {
    "objectID": "sf.html#top-zip-codes-in-san-francisco",
    "href": "sf.html#top-zip-codes-in-san-francisco",
    "title": "San Francisco Crime Dashboard",
    "section": "Top ZIP Codes in San Francisco",
    "text": "Top ZIP Codes in San Francisco\n\n\nCode\n# Clean zip codes\ndf[\"zip_code\"] = df[\"zip_code\"].astype(str).str.replace(\".0\", \"\", regex=False)\n\n# Count crimes per ZIP\nzip_counts = (\n    df.groupby(\"zip_code\")\n      .size()\n      .reset_index(name=\"crime_count\")\n      .sort_values(\"crime_count\", ascending=False)\n)\n\ntop_zip = zip_counts.head(10)\ntop_zip\n\n\n\n\n\n\n\n\n\nzip_code\ncrime_count\n\n\n\n\n0\n94102\n93221\n\n\n1\n94103\n52778\n\n\n7\n94110\n49441\n\n\n5\n94108\n45054\n\n\n24\nUnknown\n38288\n\n\n4\n94107\n36625\n\n\n18\n94124\n31929\n\n\n6\n94109\n30749\n\n\n11\n94115\n28008\n\n\n22\n94133\n27259\n\n\n\n\n\n\n\n\nüîπ Horizontal Bar Chart\n\n\nCode\nimport plotly.express as px\n\nfig = px.bar(\n    top_zip.sort_values(\"crime_count\"),\n    x=\"crime_count\",\n    y=\"zip_code\",\n    orientation=\"h\",\n    title=\"Top 10 ZIP Codes by Total Crime\",\n    labels={\"zip_code\": \"ZIP Code\", \"crime_count\": \"Crime Count\"},\n    template=\"plotly_white\"\n)\n\nfig\n\n\n                            \n                                            \n\n\n\n\nüîπ Treemap View\n\n\nCode\nfig = px.treemap(\n    top_zip,\n    path=[\"zip_code\"],\n    values=\"crime_count\",\n    title=\"Crime Volume by ZIP Code (Treemap)\",\n    template=\"plotly_white\"\n)\n\nfig"
  },
  {
    "objectID": "la.html",
    "href": "la.html",
    "title": "Los Angeles Crime Dashboard",
    "section": "",
    "text": "This page analyzes crime patterns in Los Angeles by looking at trends over time, the most common crime types, crime hotspots by ZIP code, and victim age characteristics. These visualizations help identify when crimes peak, which offenses are most frequent, and how different groups of victims are affected."
  },
  {
    "objectID": "la.html#summary",
    "href": "la.html#summary",
    "title": "Los Angeles Crime Dashboard",
    "section": "",
    "text": "This page analyzes crime patterns in Los Angeles by looking at trends over time, the most common crime types, crime hotspots by ZIP code, and victim age characteristics. These visualizations help identify when crimes peak, which offenses are most frequent, and how different groups of victims are affected."
  },
  {
    "objectID": "la.html#la-crime-map-basic-marker-map",
    "href": "la.html#la-crime-map-basic-marker-map",
    "title": "Los Angeles Crime Dashboard",
    "section": "LA Crime Map (Basic Marker Map)",
    "text": "LA Crime Map (Basic Marker Map)\n\n\nCode\nimport folium\nfrom folium.plugins import MarkerCluster\nimport pandas as pd\n\ndf = pd.read_csv(\"data/los_angeles.csv\")\n\nla_map = folium.Map(location=[34.0522, -118.2437], zoom_start=10)\nmarker_cluster = MarkerCluster().add_to(la_map)\n\ndf_sample = df.sample(n=5000, random_state=42)\n\nfor _, row in df_sample.iterrows():\n    folium.CircleMarker(\n        location=[row[\"latitude\"], row[\"longitude\"]],\n        radius=3,\n        color=\"red\",\n        fill=True,\n        fill_opacity=0.6\n    ).add_to(marker_cluster)\n\nla_map\n\n\nMake this Notebook Trusted to load map: File -&gt; Trust Notebook"
  },
  {
    "objectID": "la.html#prepare-data",
    "href": "la.html#prepare-data",
    "title": "Los Angeles Crime Dashboard",
    "section": "Prepare Data",
    "text": "Prepare Data\n\n\nCode\nimport pandas as pd\n\ndf = pd.read_csv(\"data/los_angeles.csv\")\n\ndf[\"incident_date\"] = pd.to_datetime(df[\"incident_date\"], errors=\"coerce\")\ndf[\"year\"] = df[\"incident_date\"].dt.year\ndf[\"month\"] = df[\"incident_date\"].dt.month\ndf[\"month_name\"] = df[\"incident_date\"].dt.strftime(\"%b\")\n\ndf = df.dropna(subset=[\"year\", \"month\"])\n\nmonthly_total = (\n    df.groupby([\"year\", \"month\", \"month_name\"])\n    .size()\n    .reset_index(name=\"crime_count\")\n)"
  },
  {
    "objectID": "la.html#top-crime-types-over-time-top-5",
    "href": "la.html#top-crime-types-over-time-top-5",
    "title": "Los Angeles Crime Dashboard",
    "section": "Top Crime Types Over Time (Top 5)",
    "text": "Top Crime Types Over Time (Top 5)\n\n\nCode\nmonthly_by_cat = (\n    df.groupby([\"year\", \"month\", \"month_name\", \"crime_description\"])\n    .size()\n    .reset_index(name=\"crime_count\")\n)\n\ntop_categories = df[\"crime_description\"].value_counts().head(5).index\nmonthly_by_cat = monthly_by_cat[monthly_by_cat[\"crime_description\"].isin(top_categories)]\n\n\n\n\nCode\nimport plotly.express as px\nimport plotly.graph_objects as go\n\n# --- Step 1: Keep only top 5 categories ---\ntop_categories = (\n    df[\"crime_description\"]\n      .value_counts()\n      .head(5)\n      .index\n)\n\nfiltered = monthly_by_cat[\n    monthly_by_cat[\"crime_description\"].isin(top_categories)\n].copy()\n\n# --- Step 2: available years ---\nyears = sorted(filtered[\"year\"].unique())\ndefault_year = years[0]\n\n# --- Step 3: filter initial dataset ---\ndf_year = filtered[filtered[\"year\"] == default_year]\n\n# --- Step 4: build initial plot ---\nfig = px.line(\n    df_year,\n    x=\"month_name\",\n    y=\"crime_count\",\n    color=\"crime_description\",\n    markers=True,\n    title=f\"Monthly Crime Trends by Category ({default_year})\",\n    template=\"plotly_white\"\n)\n\n# --- Step 5: Year Dropdown ---\nyear_buttons = []\n\nfor yr in years:\n    df_temp = filtered[filtered[\"year\"] == yr]\n\n    # Build x/y arrays for each category in correct order\n    x_list = [\n        df_temp[df_temp[\"crime_description\"] == cat][\"month_name\"]\n        for cat in top_categories\n    ]\n    y_list = [\n        df_temp[df_temp[\"crime_description\"] == cat][\"crime_count\"]\n        for cat in top_categories\n    ]\n\n    year_buttons.append(\n        dict(\n            label=str(yr),\n            method=\"update\",\n            args=[\n                {\n                    \"x\": x_list,\n                    \"y\": y_list,\n                },\n                {\n                    \"title\": f\"Monthly Crime Trends by Category ({yr})\"\n                }\n            ]\n        )\n    )\n\nfig.update_layout(\n    updatemenus=[\n        dict(\n            buttons=year_buttons,\n            direction=\"down\",\n            x=1.15,\n            y=1.05,\n            showactive=True\n        )\n    ]\n)\n\n# --- Step 6: Month Ordering ---\nfig.update_xaxes(\n    categoryorder=\"array\",\n    categoryarray=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"]\n)\n\nfig"
  },
  {
    "objectID": "la.html#crime-hotspots-top-zip-codes",
    "href": "la.html#crime-hotspots-top-zip-codes",
    "title": "Los Angeles Crime Dashboard",
    "section": "Crime Hotspots ‚Äî Top ZIP Codes",
    "text": "Crime Hotspots ‚Äî Top ZIP Codes\n\n\nCode\ndf[\"zip_code\"] = df[\"zip_code\"].astype(str).str.replace(\".0\", \"\", regex=False)\n\nzip_counts = (\n    df.groupby(\"zip_code\")\n      .size()\n      .reset_index(name=\"crime_count\")\n      .sort_values(\"crime_count\", ascending=False)\n)\n\ntop_zip = zip_counts.head(10)\n\nimport plotly.express as px\n\nfig = px.bar(\n    top_zip.sort_values(\"crime_count\"),\n    x=\"crime_count\",\n    y=\"zip_code\",\n    orientation=\"h\",\n    title=\"Top 10 ZIP Codes by Total Crime\",\n    labels={\"zip_code\": \"ZIP Code\", \"crime_count\": \"Total Crimes\"},\n    template=\"plotly_white\"\n)\n\nfig"
  },
  {
    "objectID": "la.html#victim-age-distribution",
    "href": "la.html#victim-age-distribution",
    "title": "Los Angeles Crime Dashboard",
    "section": "Victim Age Distribution",
    "text": "Victim Age Distribution\n\n\nCode\nimport plotly.express as px\n\n# 1. Clean age data\ndf_age_clean = df[(df[\"victim_age\"] &gt;= 0) & (df[\"victim_age\"] &lt;= 120)]\n\n# 2. Select TOP 5 crime categories\ntop5_age = (\n    df_age_clean[\"crime_description\"]\n      .value_counts()\n      .head(5)\n      .index\n)\n\ndf_top5 = df_age_clean[df_age_clean[\"crime_description\"].isin(top5_age)]\n\n# 3. Build a clean histogram\nfig = px.histogram(\n    df_top5,\n    x=\"victim_age\",\n    color=\"crime_description\",\n    nbins=40,\n    barmode=\"overlay\",\n    opacity=0.6,\n    title=\"Victim Age Distribution (Top 5 Crime Categories)\",\n    template=\"plotly_white\"\n)\n\nfig.update_layout(\n    legend_title_text=\"Crime Category\",\n    bargap=0.05\n)\n\nfig"
  },
  {
    "objectID": "la.html#victim-age-groups",
    "href": "la.html#victim-age-groups",
    "title": "Los Angeles Crime Dashboard",
    "section": "Victim Age Groups",
    "text": "Victim Age Groups\n\n\nCode\nimport pandas as pd\nimport plotly.express as px\n\n# --- Clean age data ---\ndf_age_clean = df[(df[\"victim_age\"] &gt;= 0) & (df[\"victim_age\"] &lt;= 120)].copy()\n\ndf_age_clean.loc[:, \"age_group\"] = pd.cut(\n    df_age_clean[\"victim_age\"],\n    bins=[0, 18, 30, 45, 60, 120],\n    labels=[\"0‚Äì18\", \"19‚Äì30\", \"31‚Äì45\", \"46‚Äì60\", \"60+\"]\n)\n\n# --- Step 1: Select Top 10 crimes by total count ---\ntop10_crimes = (\n    df_age_clean[\"crime_description\"]\n      .value_counts()\n      .head(10)\n      .index\n)\n\ndf_top10 = df_age_clean[df_age_clean[\"crime_description\"].isin(top10_crimes)]\n\n# --- Step 2: Group for plotting ---\nage_group_df = (\n    df_top10\n        .dropna(subset=[\"age_group\"])\n        .groupby([\"crime_description\", \"age_group\"], observed=True)\n        .size()\n        .reset_index(name=\"count\")\n)\n\n# --- Step 3: Plot ---\nfig = px.bar(\n    age_group_df,\n    x=\"crime_description\",\n    y=\"count\",\n    color=\"age_group\",\n    barmode=\"stack\",\n    title=\"Victim Age Groups (Top 10 Crimes)\",\n    template=\"plotly_white\"\n)\n\n# Make x labels readable\nfig.update_layout(\n    xaxis_tickangle=-45,\n    legend_title_text=\"Age Group\"\n)\n\nfig"
  },
  {
    "objectID": "forecast_prophet.html",
    "href": "forecast_prophet.html",
    "title": "Crime Forecasts with Prophet",
    "section": "",
    "text": "üìò Introduction\nThis page presents crime forecasting results for Los Angeles, San Diego, and San Francisco using the Prophet time-series model. Forecasts are generated from pre-computed Prophet outputs (CSV files), allowing us to visualize trends quickly without retraining the model.\nThe following visualizations include:\n\n30-day forecast comparison across the three cities\nActual vs.¬†predicted crime counts\nForecast confidence intervals\nSeasonal components (weekly, yearly, and daily)\n\nBefore examining the forecast results, we first review the historical daily crime trends, which provide essential context for understanding the model‚Äôs predictions.\n\n\nüîπ Section 1 ‚Äî Daily Crime Baseline (Before Forecasting)\n\n\n\nDaily Crime Baseline\n\n\nThis chart shows the historical daily crime counts for Los Angeles, San Diego, and San Francisco. These baseline trends reveal long-term patterns, short-term fluctuations, and seasonality‚Äîall of which inform the Prophet model‚Äôs forecasts.\n\n\nüîπ Section 2 ‚Äî Prophet Modeling: Data Preparation\n\n\nCode\nprint(\"Before fitting the forecasting models,\\nwe convert the daily crime data into the ds‚Äìy format required by Prophet.\")\n\n# ============================================================\n# Build correct DAILY crime counts for LA, SD, SF\n# ============================================================\nimport pandas as pd\n\n# ===== 1. Load raw CSVs =====\ndf_la_raw = pd.read_csv(\"data/los_angeles.csv\")\ndf_sd_raw = pd.read_csv(\"data/san_diego.csv\")\ndf_sf_raw = pd.read_csv(\"data/san_francisco.csv\", low_memory=False)\n\n\n# ===== 2. Convert to datetime =====\ndf_la_raw[\"incident_date\"] = pd.to_datetime(df_la_raw[\"incident_date\"], errors=\"coerce\")\ndf_sd_raw[\"incident_date\"] = pd.to_datetime(df_sd_raw[\"incident_date\"], errors=\"coerce\")\ndf_sf_raw[\"incident_date\"] = pd.to_datetime(df_sf_raw[\"incident_date\"], errors=\"coerce\")\n\n# ===== 3. Drop invalid dates =====\ndf_la_raw = df_la_raw.dropna(subset=[\"incident_date\"])\ndf_sd_raw = df_sd_raw.dropna(subset=[\"incident_date\"])\ndf_sf_raw = df_sf_raw.dropna(subset=[\"incident_date\"])\n\n# ===== 4. Extract PURE DATE (remove hours/min/sec) =====\ndf_la_raw[\"date\"] = df_la_raw[\"incident_date\"].dt.date\ndf_sd_raw[\"date\"] = df_sd_raw[\"incident_date\"].dt.date\ndf_sf_raw[\"date\"] = df_sf_raw[\"incident_date\"].dt.date\n\n\n# ===== 5. Group by daily counts =====\n\ndaily_la = (\n    df_la_raw.groupby(\"date\")\n    .size()\n    .reset_index(name=\"y\")\n    .rename(columns={\"date\": \"ds\"})\n)\n\n\ndaily_sd = (\n    df_sd_raw.groupby(\"date\")\n    .size()\n    .reset_index(name=\"y\")\n    .rename(columns={\"date\": \"ds\"})\n)\n\n\ndaily_sf = (\n    df_sf_raw.groupby(\"date\")\n    .size()\n    .reset_index(name=\"y\")\n    .reset_index()\n    .rename(columns={\"date\": \"ds\"})\n)\n\n# (Fix SF: previous code mis-grouped, correct version below)\n\ndaily_sf = (\n    df_sf_raw.groupby(\"date\")\n    .size()\n    .reset_index(name=\"y\")\n    .rename(columns={\"date\": \"ds\"})\n)\n\n\nBefore fitting the forecasting models,\nwe convert the daily crime data into the ds‚Äìy format required by Prophet.\n\n\n\n\nüîπ Section 3 ‚Äî Model Training\n\n\nCode\n# ===========================================\n# Prophet Model Training (All Cities)\n# ===========================================\n\nfrom prophet import Prophet\n\n# Same parameters for consistency\ndef train_prophet_model(df):\n    model = Prophet(\n        daily_seasonality=True,\n        weekly_seasonality=True,\n        yearly_seasonality=True,\n        interval_width=0.90\n    )\n    model.fit(df)\n    return model\n\nm_la = train_prophet_model(daily_la)\nm_sd = train_prophet_model(daily_sd)\nm_sf = train_prophet_model(daily_sf)\nprint(\"‚úì Prophet models trained successfully.\")\n\n\n10:51:52 - cmdstanpy - INFO - Chain [1] start processing\n10:51:52 - cmdstanpy - INFO - Chain [1] done processing\n10:51:52 - cmdstanpy - INFO - Chain [1] start processing\n10:51:52 - cmdstanpy - INFO - Chain [1] done processing\n10:51:52 - cmdstanpy - INFO - Chain [1] start processing\n10:51:53 - cmdstanpy - INFO - Chain [1] done processing\n\n\n‚úì Prophet models trained successfully.\n\n\n\n\nüîπ Section 4 ‚Äî Forecast Results\n\n\nCode\n# ============================================================\n# Forecast Results ‚Äî  Los Angeles\n# ============================================================\nprint(\"----- Los Angeles Forecast Result------\")\nfuture_la = m_la.make_future_dataframe(periods=30)\nforecast_la = m_la.predict(future_la)\ndisplay(forecast_la[[\"ds\", \"yhat\", \"yhat_lower\", \"yhat_upper\"]].tail())\n\n# ============================================================\n# Forecast Results ‚Äî  San Francisco\n# ============================================================\nprint(\"----- San Francisco Forecast Result------\")\nfuture_sf = m_sf.make_future_dataframe(periods=30)\nforecast_sf = m_sf.predict(future_sf)\ndisplay(forecast_sf[[\"ds\", \"yhat\", \"yhat_lower\", \"yhat_upper\"]].tail())\n\n# ============================================================\n# Forecast Results ‚Äî San Diego\n# ============================================================\nprint(\"----- San Diego Forecast Result------\")\nfuture_sd = m_sd.make_future_dataframe(periods=30)\nforecast_sd = m_sd.predict(future_sd)\ndisplay(forecast_sd[[\"ds\", \"yhat\", \"yhat_lower\", \"yhat_upper\"]].tail())\n\n\n----- Los Angeles Forecast Result------\n\n\n\n\n\n\n\n\n\nds\nyhat\nyhat_lower\nyhat_upper\n\n\n\n\n1904\n2025-06-24\n-171.178043\n-283.331880\n-45.667750\n\n\n1905\n2025-06-25\n-158.073769\n-281.097575\n-38.341810\n\n\n1906\n2025-06-26\n-161.695290\n-275.370971\n-42.345830\n\n\n1907\n2025-06-27\n-119.476412\n-236.265045\n-4.532973\n\n\n1908\n2025-06-28\n-141.978940\n-260.130596\n-16.888489\n\n\n\n\n\n\n\n----- San Francisco Forecast Result------\n\n\n\n\n\n\n\n\n\nds\nyhat\nyhat_lower\nyhat_upper\n\n\n\n\n2174\n2025-12-14\n185.450937\n121.377882\n243.578896\n\n\n2175\n2025-12-15\n206.020712\n139.880893\n268.909103\n\n\n2176\n2025-12-16\n208.902863\n143.561980\n270.673854\n\n\n2177\n2025-12-17\n226.950089\n167.742602\n286.941981\n\n\n2178\n2025-12-18\n213.829829\n151.097148\n276.893993\n\n\n\n\n\n\n\n----- San Diego Forecast Result------\n\n\n\n\n\n\n\n\n\nds\nyhat\nyhat_lower\nyhat_upper\n\n\n\n\n1809\n2025-12-15\n243.013641\n179.445841\n302.437851\n\n\n1810\n2025-12-16\n237.511433\n173.395003\n296.279946\n\n\n1811\n2025-12-17\n246.504209\n188.461324\n304.117097\n\n\n1812\n2025-12-18\n248.197095\n190.333489\n312.589467\n\n\n1813\n2025-12-19\n273.766830\n212.604669\n333.618922\n\n\n\n\n\n\n\n\n\nCode\n# ============================================================\n# Save Forecast Results as CSV for All 3 Cities\n# ============================================================\n# Only keep the useful columns\ncols = [\"ds\", \"yhat\", \"yhat_lower\", \"yhat_upper\"]\n\n# LA\nforecast_la_out = forecast_la[cols]\nforecast_la_out.to_csv(\"data/los_angeles_forecast.csv\", index=False)\n\n# SD\nforecast_sd_out = forecast_sd[cols]\nforecast_sd_out.to_csv(\"data/san_diego_forecast.csv\", index=False)\n\n# SF\nforecast_sf_out = forecast_sf[cols]\nforecast_sf_out.to_csv(\"data/san_francisco_forecast.csv\", index=False)\n# forecast_la_out.tail() # don't show on website\n\n\n\n\nüîπ Section 5 ‚Äî Forecast Visualization & Comparison\n\n\n1Ô∏è‚É£ 30-Day Crime Forecast Comparison\n\n\nCode\n# ============================================================\n# Forecast Comparison ‚Äî LA vs SD vs SF\n# ============================================================\n\nimport matplotlib.pyplot as plt\n\nplt.figure(figsize=(18, 7))\nplt.plot(forecast_la[\"ds\"], forecast_la[\"yhat\"], label=\"Los Angeles\", linewidth=2)\nplt.plot(forecast_sd[\"ds\"], forecast_sd[\"yhat\"], label=\"San Diego\", linewidth=2)\nplt.plot(forecast_sf[\"ds\"], forecast_sf[\"yhat\"], label=\"San Francisco\", linewidth=2)\nplt.title(\"30-Day Crime Forecast Comparison ‚Äî LA vs SD vs SF\", fontsize=20)\nplt.xlabel(\"Date\")\nplt.ylabel(\"Predicted Daily Crime Count\")\nplt.legend(fontsize=12)\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nThe 30-day crime forecast illustrates clear differences in projected crime levels across the three cities.\n\nLos Angeles begins with the highest predicted daily crime counts but shows a sharp downward decline approaching 2025.\nSan Diego remains relatively stable with moderate oscillation around its long-term mean.\nSan Francisco shows lower overall counts and smoother seasonal patterns, maintaining consistent levels over time.\n\nThe visible weekly seasonality bands (tight oscillations) reflect Prophet‚Äôs detection of short-term recurring patterns across all cities.\n\n\n2Ô∏è‚É£ Actual vs Forecast CrimeCount\n\n\nCode\n# ============================================================\n# Actual vs Forecast ‚Äî Los Angeles / San Diego / San Francisco\n# ============================================================\nimport matplotlib.pyplot as plt\n\n\ndef plot_actual_vs_forecast(daily_df, forecast_df, city_name):\n    plt.figure(figsize=(16, 6))\n\n    # actual\n    plt.plot(\n        daily_df[\"ds\"],\n        daily_df[\"y\"],\n        label=f\"{city_name} Actual\",\n        color=\"black\",\n        linewidth=1,\n    )\n\n    # forecast\n    plt.plot(\n        forecast_df[\"ds\"],\n        forecast_df[\"yhat\"],\n        label=f\"{city_name} Forecast\",\n        color=\"red\",\n        linewidth=2,\n\n    )\n\n    plt.title(f\"Actual vs Forecast ‚Äî {city_name}\", fontsize=18)\n    plt.xlabel(\"Date\")\n    plt.ylabel(\"Crime Count\")\n    plt.legend()\n    plt.tight_layout()\n    plt.show()\n\n# LA\nplot_actual_vs_forecast(daily_la, forecast_la, \"Los Angeles\")\n\n# SD\nplot_actual_vs_forecast(daily_sd, forecast_sd, \"San Diego\")\n\n# SF\nplot_actual_vs_forecast(daily_sf, forecast_sf, \"San Francisco\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3Ô∏è‚É£ Forecast with Confidence Interval (yhat_lower, yhat_upper)\n\n\nCode\n# ============================================================\n# Forecast with Confidence Interval (yhat_lower, yhat_upper)\n# ============================================================\ndef plot_forecast_interval(forecast_df, city_name):\n    plt.figure(figsize=(16, 6))\n\n    # prediction\n    plt.plot(\n        forecast_df[\"ds\"],\n        forecast_df[\"yhat\"],\n        label=f\"{city_name} Forecast\",\n        color=\"blue\",\n    )\n    # confidence interval shading\n    plt.fill_between(\n        forecast_df[\"ds\"],\n        forecast_df[\"yhat_lower\"],\n        forecast_df[\"yhat_upper\"],\n        alpha=0.3,\n        label=\"Confidence Interval\",\n\n    )\n    plt.title(f\"Forecast with Confidence Interval ‚Äî {city_name}\", fontsize=18)\n    plt.xlabel(\"Date\")\n    plt.ylabel(\"Predicted Crime Count\")\n    plt.legend()\n    plt.tight_layout()\n    plt.show()\n\n\n# LA\nplot_forecast_interval(forecast_la, \"Los Angeles\")\n\n# SD\nplot_forecast_interval(forecast_sd, \"San Diego\")\n\n# SF\nplot_forecast_interval(forecast_sf, \"San Francisco\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n4Ô∏è‚É£ Prophet Seasonal Components (Trend / Weekly / Yearly)\n\n\nCode\n# ============================================================\n# Prophet Seasonal Components (Trend / Weekly / Yearly)\n# ============================================================\n\ndef plot_prophet_components(model, city_name):\n    fig = model.plot_components(model.predict(model.make_future_dataframe(periods=30)))\n    fig.set_size_inches(12, 10)\n\n\n\nLos Angeles\n\n\nCode\n# LA\nplot_prophet_components(m_la, \"Los Angeles\")\n\n\n\n\n\n\n\n\n\n\n\nSan Diego\n\n\nCode\n# SD\nplot_prophet_components(m_sd, \"San Diego\")\n\n\n\n\n\n\n\n\n\n\n\nSan Francisco\n\n\nCode\n# SF\nplot_prophet_components(m_sf, \"San Francisco\")"
  }
]